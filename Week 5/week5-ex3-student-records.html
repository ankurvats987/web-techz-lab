<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exercise 3 - Student Record System (JSON)</title>
    <style>
      :root {
        font-family: "Verdana", "Segoe UI", sans-serif;
        --bg: #eef1f8;
        --panel: #ffffff;
        --ink: #1b1f2b;
        --muted: #5d6372;
        --accent: #2a5db0;
        --danger: #c03e3e;
        --warn: #c58b2e;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background:
          radial-gradient(circle at 10% 20%, #d9e6ff, transparent 55%),
          radial-gradient(circle at 80% 80%, #ffe6d0, transparent 55%),
          var(--bg);
        display: grid;
        place-items: center;
        padding: 32px 16px;
        color: var(--ink);
      }

      .panel {
        width: min(980px, 100%);
        background: var(--panel);
        padding: 24px;
        border-radius: 18px;
        box-shadow: 0 16px 36px rgba(22, 30, 50, 0.16);
      }

      h1 {
        margin: 0 0 8px;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 12px;
        margin-top: 16px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 6px;
      }

      input {
        width: 100%;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #cbd4e6;
        font-size: 1rem;
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 16px;
      }

      button {
        padding: 10px 14px;
        border-radius: 10px;
        border: none;
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }

      button.secondary {
        background: #3d4b74;
      }
      button.ghost {
        background: transparent;
        color: var(--accent);
        border: 1px solid var(--accent);
      }
      button.danger {
        background: var(--danger);
      }

      .status {
        margin-top: 12px;
        font-weight: 600;
      }

      .status.good {
        color: var(--accent);
      }
      .status.bad {
        color: var(--danger);
      }
      .status.warn {
        color: var(--warn);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }

      th,
      td {
        text-align: left;
        padding: 10px;
        border-bottom: 1px solid #e1e6f2;
      }

      tr:hover {
        background: #f2f6ff;
      }
    </style>
  </head>
  <body>
    <div class="panel">
      <h1>Student Record System (JSON)</h1>
      <p>CRUD operations using a local JSON file.</p>

      <form id="studentForm" novalidate>
        <div class="grid">
          <div>
            <label for="studentId">Student ID</label>
            <input id="studentId" required />
          </div>
          <div>
            <label for="studentName">Name</label>
            <input id="studentName" required />
          </div>
          <div>
            <label for="studentCourse">Course</label>
            <input id="studentCourse" required />
          </div>
          <div>
            <label for="studentMarks">Marks</label>
            <input id="studentMarks" type="number" min="0" max="100" required />
          </div>
        </div>
        <div class="actions">
          <button type="submit" id="addBtn">Add Student</button>
          <button type="button" id="updateBtn" class="secondary" hidden>
            Update Student
          </button>
          <button type="button" id="cancelBtn" class="ghost" hidden>
            Cancel Edit
          </button>
        </div>
      </form>

      <div id="status" class="status"></div>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Course</th>
            <th>Marks</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentTable"></tbody>
      </table>
    </div>

    <script>
      const form = document.getElementById("studentForm");
      const studentId = document.getElementById("studentId");
      const studentName = document.getElementById("studentName");
      const studentCourse = document.getElementById("studentCourse");
      const studentMarks = document.getElementById("studentMarks");
      const addBtn = document.getElementById("addBtn");
      const updateBtn = document.getElementById("updateBtn");
      const cancelBtn = document.getElementById("cancelBtn");
      const statusEl = document.getElementById("status");
      const tableBody = document.getElementById("studentTable");

      let students = [];
      let editingId = null;

      const setStatus = (message, tone) => {
        statusEl.textContent = message;
        statusEl.className = `status ${tone || ""}`.trim();
      };

      const resetForm = () => {
        form.reset();
        editingId = null;
        addBtn.hidden = false;
        updateBtn.hidden = true;
        cancelBtn.hidden = true;
      };

      const renderTable = () => {
        tableBody.innerHTML = "";
        if (!students.length) {
          setStatus("No student records found.", "warn");
          return;
        }

        students.forEach((student) => {
          const row = document.createElement("tr");
          row.innerHTML = `
          <td>${student.id}</td>
          <td>${student.name}</td>
          <td>${student.course}</td>
          <td>${student.marks}</td>
          <td>
            <button class="ghost" data-action="edit" data-id="${student.id}">Edit</button>
            <button class="danger" data-action="delete" data-id="${student.id}">Delete</button>
          </td>
        `;
          tableBody.appendChild(row);
        });
      };

      const readFormData = () => ({
        id: studentId.value.trim(),
        name: studentName.value.trim(),
        course: studentCourse.value.trim(),
        marks: Number(studentMarks.value),
      });

      const validateForm = () => {
        const data = readFormData();
        if (!data.id || !data.name || !data.course) {
          setStatus("All fields are required.", "warn");
          return null;
        }
        if (Number.isNaN(data.marks)) {
          setStatus("Marks must be a number.", "warn");
          return null;
        }
        return data;
      };

      const loadStudents = async () => {
        try {
          const response = await fetch("week5-ex3-students.json");
          const raw = await response.text();
          if (!response.ok) {
            throw new Error("Failed to load JSON");
          }
          const parsed = JSON.parse(raw);
          students = parsed.students || [];
          renderTable();
          setStatus("Students loaded successfully (200)", "good");
        } catch (error) {
          setStatus("Error parsing or loading JSON.", "bad");
        }
      };

      form.addEventListener("submit", (event) => {
        event.preventDefault();
        const data = validateForm();
        if (!data) {
          return;
        }
        if (students.some((student) => student.id === data.id)) {
          setStatus("Student ID already exists.", "bad");
          return;
        }
        students.push(data);
        renderTable();
        setStatus("Student added (200)", "good");
        resetForm();
      });

      updateBtn.addEventListener("click", () => {
        const data = validateForm();
        if (!data) {
          return;
        }
        const index = students.findIndex((student) => student.id === editingId);
        if (index === -1) {
          setStatus("Student not found (404)", "bad");
          return;
        }
        students[index] = data;
        renderTable();
        setStatus("Student updated (200)", "good");
        resetForm();
      });

      cancelBtn.addEventListener("click", () => {
        resetForm();
        setStatus("Edit canceled.", "warn");
      });

      tableBody.addEventListener("click", (event) => {
        const button = event.target.closest("button");
        if (!button) {
          return;
        }
        const action = button.dataset.action;
        const id = button.dataset.id;

        if (action === "edit") {
          const student = students.find((item) => item.id === id);
          if (!student) {
            setStatus("Student not found (404)", "bad");
            return;
          }
          studentId.value = student.id;
          studentName.value = student.name;
          studentCourse.value = student.course;
          studentMarks.value = student.marks;
          editingId = id;
          addBtn.hidden = true;
          updateBtn.hidden = false;
          cancelBtn.hidden = false;
          setStatus("Editing student...", "warn");
        }

        if (action === "delete") {
          const index = students.findIndex((student) => student.id === id);
          if (index === -1) {
            setStatus("Student not found (404)", "bad");
            return;
          }
          students.splice(index, 1);
          renderTable();
          setStatus("Student deleted (200)", "good");
          if (editingId === id) {
            resetForm();
          }
        }
      });

      loadStudents();
    </script>
  </body>
</html>
