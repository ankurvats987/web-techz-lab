<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Exercise 4 - AJAX Weather Dashboard</title>
    <style>
      :root {
        font-family: "Palatino Linotype", "Book Antiqua", serif;
        --bg: #eff2f5;
        --panel: #ffffff;
        --ink: #1a2333;
        --muted: #5b677c;
        --accent: #2d6cc6;
        --error: #c0392b;
      }

      body {
        margin: 0;
        min-height: 100vh;
        background:
          radial-gradient(circle at 20% 20%, #d7e8ff, transparent 60%),
          radial-gradient(circle at 80% 80%, #ffe1c7, transparent 55%),
          var(--bg);
        display: grid;
        place-items: center;
        padding: 32px 16px;
        color: var(--ink);
      }

      .panel {
        width: min(600px, 100%);
        background: var(--panel);
        padding: 26px;
        border-radius: 18px;
        box-shadow: 0 18px 36px rgba(20, 30, 50, 0.15);
      }

      h1 {
        margin: 0 0 12px;
      }

      .input-row {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 10px;
        margin-top: 16px;
      }

      input {
        padding: 12px 14px;
        border-radius: 12px;
        border: 1px solid #c8d6ef;
        font-size: 1rem;
      }

      button {
        padding: 12px 16px;
        border-radius: 12px;
        border: none;
        background: var(--accent);
        color: #fff;
        font-weight: 600;
        cursor: pointer;
      }

      .status {
        margin-top: 10px;
        font-weight: 600;
        color: var(--muted);
      }

      .status.error {
        color: var(--error);
      }

      .card {
        margin-top: 20px;
        background: #f8fbff;
        border-radius: 14px;
        padding: 16px;
        border: 1px solid #dce6f7;
        display: grid;
        gap: 8px;
      }

      .spinner {
        width: 16px;
        height: 16px;
        border: 2px solid #c5d6ef;
        border-top-color: var(--accent);
        border-radius: 50%;
        animation: spin 0.8s linear infinite;
        display: inline-block;
        vertical-align: middle;
        margin-right: 8px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>
  <body>
    <div class="panel">
      <h1>AJAX Weather Information Dashboard</h1>
      <p>Fetch live weather data using a public API.</p>

      <div class="input-row">
        <input id="cityInput" placeholder="Enter city name" />
        <button id="searchBtn">Search</button>
      </div>

      <div id="status" class="status"></div>
      <div id="result" class="card" hidden></div>
    </div>

    <script>
      const API_KEY = "OPEN_WEATHER_KEY";
      const searchBtn = document.getElementById("searchBtn");
      const cityInput = document.getElementById("cityInput");
      const statusEl = document.getElementById("status");
      const resultEl = document.getElementById("result");

      let lastResult = null;

      const setStatus = (message, isError) => {
        statusEl.textContent = message;
        statusEl.className = `status ${isError ? "error" : ""}`.trim();
      };

      const setLoading = (isLoading) => {
        if (isLoading) {
          statusEl.innerHTML =
            '<span class="spinner"></span>Loading weather data...';
        }
      };

      const renderWeather = (data, cached = false) => {
        resultEl.hidden = false;
        resultEl.innerHTML = `
        <strong>${data.city}</strong>
        <div>Temperature: ${data.temp} Â°C</div>
        <div>Humidity: ${data.humidity}%</div>
        <div>Condition: ${data.condition}</div>
      `;
        setStatus(cached ? "Showing cached result." : "Weather updated.");
      };

      const fetchWeather = async (city) => {
        if (!city) {
          setStatus("Please enter a city name.", true);
          return;
        }

        if (
          lastResult &&
          lastResult.city.toLowerCase() === city.toLowerCase()
        ) {
          renderWeather(lastResult, true);
          return;
        }

        if (API_KEY === "YOUR_OPENWEATHER_API_KEY") {
          setStatus("Add your OpenWeather API key in the script.", true);
          return;
        }

        setLoading(true);
        resultEl.hidden = true;

        try {
          const url = `https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(city)}&units=metric&appid=${API_KEY}`;
          const response = await fetch(url);
          if (!response.ok) {
            if (response.status === 404) {
              setStatus("City not found.", true);
              return;
            }
            throw new Error("Network response error");
          }

          const data = await response.json();
          const weatherInfo = {
            city: data.name,
            temp: data.main.temp,
            humidity: data.main.humidity,
            condition: data.weather[0].description,
          };

          lastResult = weatherInfo;
          renderWeather(weatherInfo);
        } catch (error) {
          setStatus("Network error. Please try again.", true);
        }
      };

      searchBtn.addEventListener("click", () => {
        fetchWeather(cityInput.value.trim());
      });

      cityInput.addEventListener("keypress", (event) => {
        if (event.key === "Enter") {
          fetchWeather(cityInput.value.trim());
        }
      });
    </script>
  </body>
</html>
